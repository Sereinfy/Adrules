name: Copy README.md

on:
  workflow_dispatch:
  push:
    branches:
      - main


jobs:
  copy-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Checkout 217heidai/adblockfilters
      uses: actions/checkout@v4
      with:
        repository: 217heidai/adblockfilters
        path: community
        
    - name: Copy README.md
      run: |
        rm -rf ./rules/*
        rm -rf *.*
        mv community/* ./
        rm -rf community*
        cp readme/README.md .
        curl -sSL -o .github/workflows/blacklist.yml https://github.com/217heidai/adblockfilters/blob/main/.github/workflows/blacklist.yml
        curl -sSL -o .github/workflows/update.yml https://github.com/217heidai/adblockfilters/blob/main/.github/workflows/update.yml
  
    - name: Apply
      run: |
        Emoji=("🎉" "🤞" "✨" "🎁" "🎈" "🎄" "🎨" "🍓" "🍕" "🍉" "💐" "🌴" "🚀" "🛸" "🗽" "⛅" "🌈" "🔥" "⛄" "🐶" "🏅" "🦄" "🐤")
        git add .
        git config --local user.name "github-actions[bot]"
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git commit -m "${Emoji[$[$RANDOM % ${#Emoji[@]}]]} Sync $(date +%Y-%m-%d" "%H:%M:%S)"
        git push -f -u origin main
